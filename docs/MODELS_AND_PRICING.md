# 使用モデルと料金詳細

**PosterAI で使用しているAIモデル**

---

## 📊 使用中のモデル一覧

### 1. **画像解析モデル**

**モデル名**: `gemini-3-pro-image-preview` ⚠️ **Preview版**  
**用途**: サンプル画像の詳細分析・特徴抽出  
**ファイル**: `app/api/analyze-image/route.ts`

**機能**:
- サンプル画像からデザイン要素を自動抽出
- カラーパレット、レイアウト、テイストの分析
- 詳細なプロンプト生成
# AIモデルと料金体系

**最終更新**: 2025-12-29  
**ステータス**: 本番運用可能

---

## 📋 現在の構成

### 画像解析

**モデル**: `gemini-3-pro-image-preview`

**機能**:
- サンプル画像の解析
- レイアウト提案
- デザイン要素の抽出

**コスト**:
- 入力画像: 約0.17円/回
- **安定性**: ⭐⭐⭐⭐⭐

---

### ポスター生成

**モデル**: `gemini-3-pro-image-preview`

**理由**:
- ✅ **安定性100%**: Dynamic Shared Quota問題なし
- ✅ **予測可能**: エラーなく確実に生成
- ✅ **実績**: 長期運用で信頼性確認済み
- ❌ Imagen 4.0は不採用（DSQ問題により本番運用不可）

**解像度別コスト**:

| サイズ | 解像度（@300dpi） | カテゴリ | コスト/枚 |
|--------|-----------------|----------|-----------|
| B5 | 2150×3035px | 2K | **¥20** |
| **A4** | **2480×3508px** | **2K** | **¥20** |
| B4 | 3035×4299px | 4K | **¥36** |
| A3 | 3508×4961px | 4K | **¥36** |

---

## 💰 月額コスト試算

### パターン1: A4サイズのみ使用

| 月間枚数 | 画像解析 | ポスター生成 | **合計** |
|---------|---------|------------|---------|
| 50枚 | ¥9 | ¥1,000 | **¥1,009** |
| 100枚 | ¥17 | ¥2,000 | **¥2,017** |
| 300枚 | ¥51 | ¥6,000 | **¥6,051** |
| 500枚 | ¥85 | ¥10,000 | **¥10,085** |

### パターン2: サイズ混在（A4:70% / B4:30%）

| 月間枚数 | 画像解析 | ポスター生成 | **合計** |
|---------|---------|------------|---------|
| 100枚 | ¥17 | ¥2,480 | **¥2,497** |
| 300枚 | ¥51 | ¥7,440 | **¥7,491** |

計算式: (A4 70枚×¥20) + (B4 30枚×¥36) = ¥2,480 ⚠️ Preview版（GA版リリース時に移行予定）  
**移行計画**: [MODEL_MONITORING_PLAN.md](MODEL_MONITORING_PLAN.md) 参照

**コスト詳細**:
- テキスト入力: 約2,000トークン
- 画像出力: 1枚 (最大4096x4096px)
- 処理時間: 約30-60秒

---

### 3. **画像生成モデル（Vertex AI専用）**

**モデル名**: `imagen-4.0-generate-001`  
**用途**: テキストのみから画像生成  
**ファイル**: `lib/gemini.ts`

**状態**: ⚠️ **現在未使用（Vertex AI SDKが必要）**  

> **注意**: Imagen 4.0はGoogle AI SDK (`@google/generative-ai`) では利用できません。  
> Vertex AI SDKへの移行が必要です。現在は`gemini-3-pro`を使用しています。

---

## 💰 料金体系

### Gemini 3 Pro Image Preview

#### 価格（参考）
Google AI Studioでは無料枠内で使用可能ですが、本番環境では課金が必要です。

**Vertex AI での料金** (2024年12月時点):
- **入力**: 画像1枚あたり
- **出力**: 生成画像1枚あたり

> ⚠️ **注意**: Gemini 3 はプレビュー版のため、正式な料金体系は未発表です。  
> Google AI Studioの無料枠を使用している場合は無料ですが、リクエスト制限があります。

---

### 参考: Gemini 1.5 Pro/Flash の料金

もし将来的にGemini 1.5シリーズに移行する場合：

#### Gemini 1.5 Pro
- **入力**: $0.00125 / 1,000文字
- **出力**: $0.00500 / 1,000文字
- **画像入力**: $0.002656 / 画像

#### Gemini 1.5 Flash
- **入力**: $0.000075 / 1,000文字
- **出力**: $0.000300 / 1,000文字  
- **画像入力**: $0.0001594 / 画像

---

### Imagen 4.0 の料金（参考）

**Imagen 4.0 Generate** (Vertex AI):
- **画像生成**: $0.04 / 画像（1枚あたり）
- **高解像度**: 追加料金あり

---

## 📈 月間コスト試算

### 現在の構成での試算

**前提条件**:
- 1ユーザーあたり月30回の生成（平均）
- 10ユーザー利用
- 合計: 300回/月

#### シナリオ1: Google AI Studio（無料枠）

**料金**: $0/月 ✅

**制限**:
- RPM（Requests Per Minute）制限あり
- 商用利用には適さない可能性

---

#### シナリオ2: Vertex AI（従量課金）

**Gemini 3 Pro Image Previewの場合** (料金未確定):
- 仮に $0.02/リクエストと仮定
- **月間コスト**: $6/月

**Gemini 1.5 Flashに移行した場合** (推奨):
- 画像解析: 300回 × $0.0001594 = **$0.048**
- ポスター生成: 300回 × $0.0001594 = **$0.048**
- テキスト処理: 約 **$1-2**
- **月間コスト**: **約 $2-3/月** ✅

**Imagen 4.0を使用した場合**:
- ポスター生成: 300回 × $0.04 = **$12/月**
- 画像解析: Gemini使用 = **$0.048**
- **月間コスト**: **約 $12-15/月**

---

## 🎯 コスト最適化の推奨事項

### 1. **モデル構成の見直し**

現在の構成（推奨）:
```
画像解析: gemini-1.5-flash (高速・安価)
ポスター生成: gemini-3-pro-image-preview (高品質)
```

**月間コスト**: 約 $2-3/月

---

### 2. **段階的な移行プラン**

#### フェーズ1: 開発・テスト（現在）
- **Google AI Studio** の無料枠を使用
- **コスト**: $0/月
- **制限**: RPM制限あり

#### フェーズ2: 小規模本番環境
- **Vertex AI** に移行
- **Gemini 1.5 Flash** 使用
- **コスト**: $2-5/月
- **制限**: なし

#### フェーズ3: 大規模本番環境
- 用途に応じてモデル選択
  - 画像解析: Gemini 1.5 Flash
  - ポスター生成: Gemini 1.5 Pro または Imagen 4.0
- **コスト**: $10-50/月（ユーザー数による）

---

## 📝 現在の API キー設定

### 環境変数
```
GEMINI_API_KEY=your_gemini_api_key_here
```

**タイプ**: Google AI Studio API Key  
**料金**: 無料枠内（RPM制限あり）

> **重要**: 実際のAPIキーは `.env.local` に設定し、GitHubにコミットしないでください。

---

## 🔄 今後の推奨アクション

### 本番環境への移行時

1. **Vertex AI プロジェクトを作成**
   ```bash
   gcloud projects create posterai-production
   ```

2. **Vertex AI API を有効化**
   ```bash
   gcloud services enable aiplatform.googleapis.com
   ```

3. **サービスアカウント作成**
   ```bash
   gcloud iam service-accounts create posterai-sa
   ```

4. **環境変数を更新**
   ```env
   GOOGLE_CLOUD_PROJECT_ID=posterai-production
   GOOGLE_CLOUD_LOCATION=us-central1
   GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account-key.json
   ```

5. **コードを更新**（Vertex AI SDK使用）

---

## 💡 料金節約のヒント

### 1. キャッシング戦略
- 同じサンプル画像の解析結果をキャッシュ
- 重複リクエストを削減

### 2. バッチ処理
- 複数のリクエストをまとめて処理
- API呼び出し回数を削減

### 3. レート制限の活用
- 現在の100回/日制限で十分な場合が多い
- 必要に応じて緩和

### 4. モデル選択の最適化
- 簡単な解析: Gemini 1.5 Flash（安価・高速）
- 複雑な生成: Gemini 1.5 Pro（高品質）

---

## 📊 コスト比較表

| モデル | 用途 | 価格/リクエスト | 100回/日のコスト/月 |
|--------|------|----------------|-------------------|
| **Gemini 1.5 Flash** | 画像解析 | $0.0001594 | **$0.48** ✅ |
| **Gemini 1.5 Pro** | 高品質生成 | $0.002656 | **$7.97** |
| **Gemini 3 Pro Preview** | 現在使用中 | 未定 | **$0 (開発中)** |
| **Imagen 4.0** | 画像生成 | $0.04 | **$120** |

---

## まとめ

### 現在の状態（2025年12月29日更新）
- **画像解析**: Gemini 3 Pro（GA版）
- **ポスター生成**: Imagen 4.0（GA版）
- **料金**: 約$12/月（300回/月想定）
- **状態**: 本番環境対応完了 ✅

### 本番環境推奨
- **使用モデル**: Gemini 1.5 Flash
- **料金**: $2-5/月（小規模～中規模）
- **制限**: なし

### 将来的な選択肢
- スケールアップ時: Gemini 1.5 Pro または Imagen 4.0
- 予想コスト: $10-50/月（ユーザー数・使用量による）

---

**更新日**: 2025-12-29
